<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Calculate optimal design parameters for a two-stage gold-standard design"><title>Calculate optimal design parameters for a two-stage gold-standard design — optimize_design_twostage • OptimalGoldstandardDesigns</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate optimal design parameters for a two-stage gold-standard design — optimize_design_twostage"><meta property="og:description" content="Calculate optimal design parameters for a two-stage gold-standard design"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">OptimalGoldstandardDesigns</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Introduction.html">Usage guidance</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/jan-imbi/OptimalGoldstandardDesigns/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Calculate optimal design parameters for a two-stage gold-standard design</h1>
      <small class="dont-index">Source: <a href="https://github.com/jan-imbi/OptimalGoldstandardDesigns/blob/HEAD/R/optimization_methods.R" class="external-link"><code>R/optimization_methods.R</code></a></small>
      <div class="d-none name"><code>optimize_design_twostage.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculate optimal design parameters for a two-stage gold-standard design</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">optimize_design_twostage</span><span class="op">(</span></span>
<span>  cT2 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cP1 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cP2 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cC1 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cC2 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bTP1f <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bTP1e <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bTC1f <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bTC1e <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.025</span>,</span>
<span>  beta <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  alternative_TP <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>  alternative_TC <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  Delta <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  varT <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  varP <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  varC <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  binding_futility <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  always_both_futility_tests <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  round_n <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  lambda <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  kappa <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  eta <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  objective <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="va">ASN</span><span class="op">[[</span><span class="st">"H11"</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span> <span class="op">*</span></span>
<span>    <span class="va">ASN</span><span class="op">[[</span><span class="st">"H10"</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span> <span class="op">*</span> <span class="va">ASN</span><span class="op">[[</span><span class="st">"H01"</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="va">ASN</span><span class="op">[[</span><span class="st">"H00"</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">kappa</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="va">ASNP</span><span class="op">[[</span><span class="st">"H11"</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span> <span class="op">*</span> <span class="va">ASNP</span><span class="op">[[</span><span class="st">"H10"</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span> <span class="op">*</span></span>
<span>    <span class="va">ASNP</span><span class="op">[[</span><span class="st">"H01"</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="va">ASNP</span><span class="op">[[</span><span class="st">"H00"</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">eta</span> <span class="op">*</span> <span class="va">cumn</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"P"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">eta</span></span>
<span>    <span class="op">*</span> <span class="op">(</span><span class="va">cumn</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"T"</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">cumn</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"P"</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">cumn</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"C"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  inner_tol_objective <span class="op">=</span> <span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span><span class="op">^</span><span class="fl">0.25</span>,</span>
<span>  mvnorm_algorithm <span class="op">=</span> <span class="fu">mvtnorm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mvtnorm/man/algorithms.html" class="external-link">Miwa</a></span><span class="op">(</span>steps <span class="op">=</span> <span class="fl">128</span>, checkCorr <span class="op">=</span> <span class="cn">FALSE</span>, maxval <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>,</span>
<span>  nloptr_x0 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nloptr_lb <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nloptr_ub <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nloptr_opts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>algorithm <span class="op">=</span> <span class="st">"NLOPT_LN_SBPLX"</span>, ftol_rel <span class="op">=</span> <span class="fl">1e-04</span>, xtol_abs <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>    xtol_rel <span class="op">=</span> <span class="fl">0.01</span>, maxeval <span class="op">=</span> <span class="fl">1000</span>, print_level <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>  print_progress <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>cT2</dt>
<dd><p>(numeric) allocation ratio nT2 / nT1. Parameter to be optimized if left unspecified.</p></dd>


<dt>cP1</dt>
<dd><p>(numeric) allocation ratio nP1 / nT1. Parameter to be optimized if left unspecified.</p></dd>


<dt>cP2</dt>
<dd><p>(numeric) allocation ratio nP2 / nT1. Parameter to be optimized if left unspecified.</p></dd>


<dt>cC1</dt>
<dd><p>(numeric) allocation ratio nC1 / nT1. Parameter to be optimized if left unspecified.</p></dd>


<dt>cC2</dt>
<dd><p>(numeric) allocation ratio nC2 / nT1. Parameter to be optimized if left unspecified.</p></dd>


<dt>bTP1f</dt>
<dd><p>(numeric) first stage futility boundary for the T vs. P testing problem. Parameter to be optimized if left unspecified.</p></dd>


<dt>bTP1e</dt>
<dd><p>(numeric) first stage critical value for the T vs. P testing problem. Parameter to be optimized if left unspecified.</p></dd>


<dt>bTC1f</dt>
<dd><p>(numeric) first stage futility boundary for the T vs. C testing problem. Parameter to be optimized if left unspecified.</p></dd>


<dt>bTC1e</dt>
<dd><p>(numeric) first stage critical value for the T vs. C testing problem. Parameter to be optimized if left unspecified.</p></dd>


<dt>alpha</dt>
<dd><p>type I error rate.</p></dd>


<dt>beta</dt>
<dd><p>type II error rate.</p></dd>


<dt>alternative_TP</dt>
<dd><p>assumed difference between T and P under H1. Positive values favor T.</p></dd>


<dt>alternative_TC</dt>
<dd><p>assumed difference between T and C under H1. Positive values favor T.</p></dd>


<dt>Delta</dt>
<dd><p>non-inferiority margin for the test \(X_T - X_C \leq - \Delta\) vs.
\(X_T - X_C &gt; - \Delta\).</p></dd>


<dt>varT</dt>
<dd><p>variance of treatment group.</p></dd>


<dt>varP</dt>
<dd><p>variance of placebo group.</p></dd>


<dt>varC</dt>
<dd><p>variance of control group.</p></dd>


<dt>binding_futility</dt>
<dd><p>(logical) controls if futility boundaries are binding.</p></dd>


<dt>always_both_futility_tests</dt>
<dd><p>(logical) if true, both futility tests are performed after the first stage. If false,
a 'completely sequential' testing procedure is employed (see Appendix of (Meis et al. 2023)
).</p></dd>


<dt>round_n</dt>
<dd><p>(logical) if TRUE, a design with integer valued sample sizes is returned.</p></dd>


<dt>lambda</dt>
<dd><p>(numeric) weight of the alternative hypothesis in the default objective function. 1-lambda is the weight
of the null hypothesis.</p></dd>


<dt>kappa</dt>
<dd><p>(numeric) penalty factor for placebo patients in the default objective function.</p></dd>


<dt>eta</dt>
<dd><p>(numeric) penalty factor for the maximum sample size in the default objective function.</p></dd>


<dt>objective</dt>
<dd><p>(expression) objective criterion.</p></dd>


<dt>inner_tol_objective</dt>
<dd><p>(numeric) used to determine the tolerances for integrals and nuisance optimization problems
inside the objective function.</p></dd>


<dt>mvnorm_algorithm</dt>
<dd><p>algorithm for multivariate integration passed to <code><a href="https://rdrr.io/pkg/mvtnorm/man/pmvnorm.html" class="external-link">pmvnorm</a></code>.</p></dd>


<dt>nloptr_x0</dt>
<dd><p>(numeric vector) starting point for optimization.</p></dd>


<dt>nloptr_lb</dt>
<dd><p>(numeric vector) lower bound box for box constrained optimization.</p></dd>


<dt>nloptr_ub</dt>
<dd><p>(numeric vector) upper bound box for box constrained optimization.</p></dd>


<dt>nloptr_opts</dt>
<dd><p>(list) nloptr options. See <code><a href="https://rdrr.io/pkg/nloptr/man/nloptr.html" class="external-link">nloptr</a></code>.</p></dd>


<dt>print_progress</dt>
<dd><p>(logical) controls whether optimization progress should be visualized during the calculation.</p></dd>


<dt>...</dt>
<dd><p>additional arguments passed along.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Design object (a list) with optimized design parameters.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function calculates optimal design parameters for a two-stage three-arm gold-standard
non-inferiority trial. Run <code><a href="../articles/Introduction.html">vignette("Introduction", package = "OptimalGoldstandardDesigns")</a></code>
to see some examples related to the associated paper (Meis et al. 2023)
.</p>
<p>Parameters which can be optimized are the allocation ratios for all groups and stages and the
futility and efficacy boundaries of the first stage. The allocation ratios are
cT2 = nT2 / nT1, cP1 = nP1 / nT1,
cP2 = nP2 / nT1, cC1 = nC1 / nT1 and cC2 = nC2 / nT1. Here, nT1 denotes the sample size
of the treatment group in the first stage, nP2 the sample size of the placebo group in the
second stage, etc. The first stage efficacy boundaries are bTP1e for the treatment vs
placebo testing problem, and bTC1e for the treatment vs control non-inferiority testing
problem. The futility boundaries are denoted by bTP1f and bTC1f.</p>
<p>If these parameters are left unspecified or set to NULL, they will be included into the
optimization process, otherwise they will be considered boundary constraints.
You may also supply quoted expressions as arguments for these
parameters to solve a constrained optimization problem. For example, you can supply
<code>cT2 = 1, cP2 = quote(cP1), cC2 = quote(cC1)</code> to ensure that the first and second
stage allocation ratios are equal.</p>
<p>The design is optimized with respect to the objective criterion given by the parameter
<code>objective</code>. The default objective function is described in the
Subsection <em>Optimizing group sequential gold-standard designs</em> in Section 2
of (Meis et al. 2023)
. Additionally,
this objective includes a term to penalize the maximum sample size of a trial,
which can be controlled by the parameter <code>eta</code> (default is <code>eta=0</code>).</p>
<p>Designs are calculated to fulfill the following constraints: the family-wise type I error
rate is controlled at <code>alpha</code> under any combination of the two null hypotheses
<code>muT - muP = 0</code> and <code>muT - muC + Delta = 0</code>.
The power to reject both hypothesis given both alternative
hypotheses <code>muT - muP = alternative_TP</code> and <code>muT - muC + Delta = alternative_TC + Delta</code>
is at least <code>1 - beta</code>. Variances are assumed to be given by <code>varT, varP</code> and <code>varC</code>.</p>
<p>If <code>binding_futility</code> is <code>TRUE</code>, type I error recycling is used.
If <code>always_both_futility_tests</code> is <code>TRUE</code>, it is assumed that futility tests for both
hypotheses are performed at interim, regardless of whether the treatment vs placebo null hypothesis
was successfully rejected. If <code>always_both_futility_tests</code> is <code>FALSE</code>, the futility
test for the treatment vs. control testing problem only needs to be done if the null for the
treatment vs. placebo testing problem was rejected in the first stage.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Meis J, Pilz M, Herrmann C, Bokelmann B, Rauch G, Kieser M (2023).
“Optimization of the two-stage group sequential three-arm gold-standard design for non-inferiority trials.”
<em>Statistics in Medicine</em>, <b>42</b>(4), 536-558.
<a href="https://doi.org/10.1002/sim.9630" class="external-link">doi:10.1002/sim.9630</a>
.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Should take about 15 seconds.</span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="fu">optimize_design_twostage</span><span class="op">(</span></span></span>
<span class="r-in"><span>  cT2 <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  cP2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="va">cP1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  cC2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="va">cC1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  bTP1f <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,</span></span>
<span class="r-in"><span>  bTC1f <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,</span></span>
<span class="r-in"><span>  beta <span class="op">=</span> <span class="fl">0.2</span>,</span></span>
<span class="r-in"><span>  alternative_TP <span class="op">=</span> <span class="fl">0.4</span>,</span></span>
<span class="r-in"><span>  alternative_TC <span class="op">=</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>  Delta <span class="op">=</span> <span class="fl">0.2</span>,</span></span>
<span class="r-in"><span>  binding_futility <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  lambda <span class="op">=</span> <span class="fl">.9</span>,</span></span>
<span class="r-in"><span>  kappa <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  nloptr_opts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>algorithm <span class="op">=</span> <span class="st">"NLOPT_LN_SBPLX"</span>, ftol_rel <span class="op">=</span> <span class="fl">1e-01</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  iteration: 1/100                                                                    cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.250000, 1.000000, 2.105099, 2.270933)                                      f(x) = 915.8373                                                              iteration: 2/100                                                                    cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.250000, 1.000000, 2.105099, 2.270933)                                      f(x) = 915.8373                                                              iteration: 3/100                                                                    cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.250000, 1.000000, 2.105099, 2.270933)                                      f(x) = 915.8373                                                              iteration: 4/100                                                                    cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.428125, 1.000000, 2.105099, 2.270933)                                      f(x) = 917.2013                                                              iteration: 5/100                                                                    cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.250000, 1.712500, 2.105099, 2.270933)                                      f(x) = 1022.588                                                              iteration: 6/100                                                                    cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.428125, 0.287500, 2.105099, 2.270933)                                      f(x) = 1412.46                                                               iteration: 7/100                                                                    cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.2945313, 1.3562500, 2.1050990, 2.2709330)                                  f(x) = 935.5908                                                              iteration: 8/100                                                                    cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.3835937, 0.6437500, 2.1050990, 2.2709330)                                  f(x) = 963.2407                                                              iteration: 9/100                                                                    cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.3167969, 1.1781250, 2.1050990, 2.2709330)                                  f(x) = 911.3385                                                              iteration: 10/100                                                                   cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.1386719, 1.1781250, 2.1050990, 2.2709330)                                  f(x) = 1108.736                                                              iteration: 11/100                                                                   cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.3557617, 1.0445312, 2.1050990, 2.2709330)                                  f(x) = 904.044                                                               iteration: 12/100                                                                   cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.3557617, 1.0445312, 2.2139503, 2.2709330)                                  f(x) = 908.8018                                                              iteration: 13/100                                                                   cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.3557617, 1.0445312, 2.1050990, 2.5041598)                                  f(x) = 907.0289                                                              iteration: 14/100                                                                   cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.3557617, 1.0445312, 1.9962477, 2.5041598)                                  f(x) = 918.6257                                                              iteration: 15/100                                                                   cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.3557617, 1.0445312, 2.1595246, 2.3292397)                                  f(x) = 903.9803                                                              iteration: 16/100                                                                   cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.3557617, 1.0445312, 2.1595246, 2.0960129)                                  f(x) = 935.7317                                                              iteration: 17/100                                                                   cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.3557617, 1.0445312, 2.1187054, 2.4021231)                                  f(x) = 903.2534                                                              iteration: 18/100                                                                   cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.3557617, 1.0445312, 2.1731310, 2.4604297)                                  f(x) = 906.1748                                                              iteration: 19/100                                                                   cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.3557617, 1.0445312, 2.1221070, 2.3183072)                                  f(x) = 902.9637                                                              iteration: 20/100                                                                   cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.3557617, 1.0445312, 2.0812878, 2.3911905)                                  f(x) = 903.0437                                                              iteration: 21/100                                                                   cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.3557617, 1.0445312, 2.0846894, 2.3073747)                                  f(x) = 902.7042                                                              iteration: 22/100                                                                   cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.3557617, 1.0445312, 2.0676814, 2.2600005)                                  f(x) = 904.3596                                                              iteration: 23/100                                                                   cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.3557617, 1.0445312, 2.1255086, 2.2344913)                                  f(x) = 906.9245                                                              iteration: 24/100                                                                   cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.3557617, 1.0445312, 2.0923430, 2.3520157)                                  f(x) = 902.4161                                                              iteration: 25/100                                                                   cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.3557617, 1.0445312, 2.0549254, 2.3410832)                                  f(x) = 903.1108                                                              iteration: 26/100                                                                   cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.3557617, 1.0445312, 2.1053116, 2.3240012)                                  f(x) = 902.5799                                                              iteration: 27/100                                                                   cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.3557617, 1.0445312, 2.1129652, 2.3686423)                                  f(x) = 902.6578                                                              iteration: 28/100                                                                   cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.3557617, 1.0445312, 2.1058963, 2.3533254)                                  f(x) = 902.4788                                                              iteration: 29/100                                                                   cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.3557617, 1.0445312, 2.0929276, 2.3813399)                                  f(x) = 902.7331                                                              iteration: 30/100                                                                   cP1 &lt;- x[1L] cC1 &lt;- x[2L] bTP1e &lt;- x[3L] bTC1e &lt;- x[4L]                             x = c(0.3557617, 1.0445312, 2.1022156, 2.3383359)                                  f(x) = 902.4439                                                             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Optimization finished. Calculating final design with greater accuracy...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sample sizes (stage 1): T: 209, P: 75, C: 219</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sample sizes (stage 2): T: 209, P: 75, C: 219</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Efficacy boundaries (stage 1): Z_TP_e: 2.09234, Z_TC_e: 2.35202</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Futility boundaries (stage 1): Z_TP_f: -Inf, Z_TC_f: -Inf</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Efficacy boundaries (stage 2): Z_TP_e: 2.29395, Z_TC_e: 2.06436</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Inverse normal combination test weights (TP): w1: 0.70711, w2: 0.70711</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Inverse normal combination test weights (TC): w1: 0.70711, w2: 0.70711</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Maximum overall sample size: 1006</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Expected sample size (H1): 795.7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Expected sample size (H0): 1004.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Expected placebo group sample size (H1): 89.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Expected placebo group sample size (H0): 148.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Objective function value: 905.7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (local) type I error for TP testing: 2.50%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (local) type I error for TC testing: 2.50%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Probability of futility stop (H1): 0.00%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Probability of futility stop (H0): 0.00%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Minimum conditional power: 0.00%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Power: 80.03%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Futility boundaries: binding</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Futility testing method: always both futility tests</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Jan Meis.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

